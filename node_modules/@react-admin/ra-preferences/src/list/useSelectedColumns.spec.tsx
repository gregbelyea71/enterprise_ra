import * as React from 'react';
import { TextField } from 'react-admin';
import { render } from '@testing-library/react';
import { useSelectedColumns } from './useSelectedColumns';

describe('useSelectedColumns', () => {
    test('should filter out unknown columns', () => {
        jest.spyOn(Storage.prototype, 'getItem').mockReturnValue(
            JSON.stringify({ 'posts.list.columns': ['title', 'unknown'] })
        );
        let finalColumns;
        const Component = () => {
            const postListColumns = {
                title: <TextField source="title" />,
                teaser: <TextField source="artist" />,
            };

            const columns = useSelectedColumns({
                preferences: 'posts.list.columns',
                columns: postListColumns,
                omit: ['nb_views'],
            });

            finalColumns = columns;
            return null;
        };

        render(<Component />);

        expect(finalColumns.map(column => column.props.source)).toEqual([
            'title',
        ]);
    });
});
